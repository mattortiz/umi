---
translateHelp: true
---

# FAQ

## General

### Can Umi 3 be written only in TypeScript?

It's not. It is also valid to replace `.ts` with `.js` in the document, because you don't want to bring `.(j|t)sx?` every time.

### import from umi What if there is no definition？

such as：

```js
import { history } from 'umi';
```

May report `xxx has no exported member 'history'`。

Two things need to be ensured at this time，

1. There is a path to configure `@@` in tsconfig.json, such as `"@@/*": ["src/.umi/*"]`, refer to [tsconfig.json template](https://github. com/umijs/umi/blob/master/packages/create-umi-app/templates/AppGenerator/tsconfig.json)
2. Make sure that `src/.umi/core/umiExports.ts` has relevant content, if not, it can be generated by any command of ʻumi build`, ʻumi dev` or ʻumi g tmp`

### How to dynamically modify the title?

The title can be dynamically modified through the [plugin-helmet](/plugins/plugin-helmet) plugin.

### How does the layout route pass values ​​to sub-routes

It is recommended to use the context or data flow scheme. If you use cloneElement to pass the value, you need to pass two levels, because the first level is Switch, and then Route.

```js
React.Children.map(children, child => {
  return React.cloneElement(child, null, React.Children.map(child.props.children, child => {
    return React.cloneElement(child, { test: 'test' });
  }));
})
```

reference:

* https://github.com/umijs/umi/pull/1282#issue-224134432

## Report an error

### ʻumi` is not an internal or external command

e.g.

<img src="https://gw.alipayobjects.com/zos/rmsportal/fatmbcGwSOwDntHjmrtG.png" />

The NODE_PATH environment variable needs to be configured. If yarn is used, the bin path can be obtained by executing `yarn global bin`.

### After configuring `dynamicImport.loading`, what should I do if the outer error does not take effect?

There are two forms of component error:
1)

```js
a(); // 出错
export default () => <>..</>;
```

2)

```js
export default () => {
  a(); // Error
  return <>..</>;
}
```

The second type can throw errors normally no matter what, the first type may not take effect when dynamicImport is turned on and loading is configured.

For example, the content of the file pointed to by loading is:

```js
export default () => <>loading...</>
```

Then only loading... will be displayed when an error occurs.

#### Solve

loading handles error scenarios, such as:

```js
export default class extends React.PureComponent {
  render() {
    if (process.env.NODE_ENV === 'development' && this.props.error) {
      console.error(this.props.error.stack);
      return <div>{this.props.error.stack}</div>;
    }
    return <div>loading...</div>;
  }
};
```

### ie error report and compression problem solving ideas

I feel that the errors under IE are caused by this problem.

#### Typical errors

![image](https://user-images.githubusercontent.com/11746742/62197556-a37dec00-b3b2-11e9-8f72-999058e9b305.png)

#### Solutions

##### The first step, confirm your needs

Mainly **Is it necessary to be compatible with older browsers that do not support es6**,

* If you need compatibility, skip to the second step
* If compatibility is not required, configure `minimizer` as `terserjs`

##### Step 2

Check the `targets` configuration to confirm whether there are older browsers such as,

```js
{
  targets: { ie: 10 },
}
```

Try to build, and if there are no problems, you don't need to perform the next step.

##### The third step, record the error file and line number

Like the previous one,

* File: vendors.async.js
* Line number: 193
* Error token: `>`

##### Fourth step, build without compression, find the source of the error

```bash
# If you use umi
$ COMPRESS=none umi build

# If you use bigfish
$ COMPRESS=none bigfish build
```

Look for line 193 of `vendors.async.js` to see which package is wrong, and record the package name and version number.

##### Step 5. Modify the local `node_modules/es5-imcompatible-versions/package.json` file, and write the package name and version number that just went wrong.

```js
"antd-table-infinity": {
        "^1.1.2": {
          "version": "^1.1.2",
          "reason": "https://github.com/Leonard-Li777/antd-table-infinity/blob/master/src/components/Table/InfinityTable/index.jsx#L7"
        }
      }
```

##### Step 6, save the file, rebuild, and confirm that the error has been fixed

##### Seventh step, PR to [es5-imcompatible-versions](https://github.com/umijs/es5-imcompatible-versions)

###### Students who will not submit PR, please follow the steps below
1. In [Edit](https://github.com/umijs/es5-imcompatible-versions/edit/master/package.json), modify your just now and also modify it here.
2. After the modification, the page is pulled to the bottom. Create a branch (it may be the case of automatic branch creation, if there is no choice, just ignore it here) click the green button `Propose file change`
![image](https://user-images.githubusercontent.com/11746742/62198380-189df100-b3b4-11e9-8684-8e5fc9d2e929.png)
3. On the page after the jump, click the green button `Create pull request`
![image](https://user-images.githubusercontent.com/11746742/62198516-5ac73280-b3b4-11e9-9130-aaee6defdb03.png)

##### Step 8. Send the link after the jump to the group. Waiting to merge

Such as: `https://github.com/umijs/es5-imcompatible-versions/pull/36`

#### Reference

* [https://github.com/sorrycc/blog/issues/68](https://github.com/sorrycc/blog/issues/68)
* [https://github.com/umijs/es5-imcompatible-versions](https://github.com/umijs/es5-imcompatible-versions)

### The dependency was not found

![The dependency was not found](https://user-images.githubusercontent.com/11746742/87644864-49229a80-c77f-11ea-909d-8e3d2bb5d7c2.png)

Generally, it is caused by a bad network installation error. You can delete `*.lock` and `node_modules` and re-execute `yarn`. If you try multiple times, you can't solve it. You can execute `git clean -dfx` in the project directory and reinstall it. Generally, it can be solved.

If your colleagues can run the same project, you run an error. It is generally caused by errors in the process of caching or installing packages. You can try to delete several cache directories, for example, delete `src/.umi/cache` and try again.

## webpack

### How to configure additional loaders?

For example, svg I hope not to use base64, but to generate all svg files, which can be configured like this:

```js
export default {
  // 添加 url-loader 的 exclude
  urlLoaderExcludes: [/.svg$/],
  // 添加 loader
  chainWebpack(config) {
    config.module.rule('svg-with-file')
      .test(/.svg$/)
      .use('svg-with-file-loader')
      .loader('file-loader')
  },
}
```

## CSS

### Why does my imported css file not take effect?

Umi turns on css modules by default, please write in the same way as css modules.

reference:

* [css-modules/css-modules](https://github.com/css-modules/css-modules)
* [CSS Modules Usage Tutorial](http://www.ruanyifeng.com/blog/2016/06/css_modules.html)

### How to disable css modules?

Modify `.umirc.js`:

```json
{
 "disableCSSModules": true
}
```

But when there is no special reason, it is not recommended to turn off css modules.

### How to use sass?

Install additional dependencies first,

```bash
$ npm i node-sass sass-loader --save
```

Then modify `.umirc.js`:

```json
{
 "sass": {}
}
```

#### How to package css into a file after opening on-demand loading?

Configure splitChunks, such as:

```js
export default {
  dynamicImport: {
  },
  chainWebpack(config) {
    config.optimization.splitChunks({
      cacheGroups: {
        styles: {
          name: 'styles',
          test: /\.(css|less)$/,
          chunks: 'async',
          minChunks: 1,
          minSize: 0,
        }
      },
    });
  },
}
```

After packaging, it will output:

```
File sizes after gzip:

  126.85 KB  dist/umi.js
  535 B      dist/p__users.async.js
  533 B      dist/p__index.async.js
  337 B      dist/styles.async.js
  96 B       dist/styles.chunk.css
```

Example:

* [sorrycc-123.zip](https://github.com/umijs/umi/files/2556654/sorrycc-123.zip)

reference:

* https://github.com/webpack-contrib/mini-css-extract-plugin#extracting-all-css-in-a-single-file
* https://github.com/umijs/umi/blob/master/packages/umi-plugin-react/test/chunks/.umirc.js#L1

### How to disable the loading... status that appears every time the route is refreshed?

Add `loading:'() => <></>'` to the dynamicImport configuration, for example:

```
export default {
  dynamicImport: {
    loading: '() => <></>
  },
}
```

## Test

### How to breakpoint debugging

Make sure node is above 8.10, then execute:

```bash
$ node --inspect-brk ./node_modules/.bin/umi test
```

Then open chrome://inspect/#devices in the browser to inspect and breakpoints.

## Request

### Proxy proxy is unsuccessful, no proxy to the actual address

![image](https://user-images.githubusercontent.com/22974879/48049412-8debe500-e1d9-11e8-8f36-0c3aa89c50b0.png)

The proxy is only a service request proxy, and this address will not change.
The principle can be simply understood as that when you start a service locally, you first request the local service, and the local service forwards your request to the actual server. So the request address you see on the browser is still http://localhost:8000/xxx. Subject to whether the server receives the request

https://github.com/ant-design/ant-design-pro/issues/2779

## Deployment

### After build, visit the route after refresh 404?

Several options are available:

* Use hashHistory instead, with `history:'hash'` in `.umirc.js`
* Static, configure ʻexportStatic: true` in `.umirc.js`
* The server configures the route fallback to index.html

### Lost pictures after build?

It may be that the picture is not quoted correctly, you can refer to the code and import the picture correctly.

```js
import React from 'react';
import logo from './logo.png'; // tell WebPACK this JS file to use this image

console.log(logo); // logo.84287d09.png

function Header() {
  // Import pictures
  return <img src={logo} alt="Logo" />;
}

export default Header;

```
Use in css, be careful not to use absolute path
```css
.Logo {
  background-image: url(./logo.png);
}
```

> Note: When the image size is less than 10k, it will go to base64. That is, it will not be copied to the public folder, but will exist as base64 resources.

### When deploying to a static file service, if it is used with cordova, the page is blank, and the file cannot be found?

You can try to configure `publicPath:'./',`
